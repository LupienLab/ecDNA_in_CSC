motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-3"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "TCF4,TCF3", "", "", "",                                                                             #5
"Klf7,Klf12", "Tcf4,Tcf3", "Sox6,Sox11,Sox4,Sox3,Sox10,Sox15", "", "Tcfap2e,SOX11,Sox4",           #10
"Sox1,Sox17", "Sox5", "", "", "Smad2,Smad4,Smad3",                                                             #15
"Tcf21,Tcf12", "Klf4,KLF5,KLF1", "", "Tcfap2e,Tcf3"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G620_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "", "", "POU6F2,Pou6f1", "KLF10,KLF9",                                                                               #5
"", "NeuroD1,Ascl2,Ascl1,Tcf3", "", "Sox6,Sox15,Sox14,Sox2,Sox17,Sox3,Sox10,Sox9", "",                                    #10
"Brn1", "", "", "", "",                                                                                                   #15
"Eomes,TCF3,TCF4", "Tbx5,TBX4", "", "", "",                                                                                        #20
"RUNX2,RUNX1,Klf4", "RUNX2,RUNX1", "POU5F1,Oct4,Sox17,POU2F2,Oct6", "Sox7,Sox15,Sox21,Sox8,Sox30,Sox9,Sox2", "POU6F1",    #25
"RUNX2,RUNX1", "", "Sox14", "Sox3,Sox12,Sox6,Tbox:Smad,Sox14,Sox4,SOX10"                                                            #30
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "Pou5f1::Sox2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX5", "TBX15", "Tbx20", "Tbox:Smad", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "Pou5f1::Sox2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX5", "TBX15", "Tbx20", "Tbox:Smad", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(JunJunZai)
id = "G523_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "", "SOX3,Sox11,Sox4,RUNX1,Sox2,Sox6", "Smad3,Smad4", "",                                      #5
"Twist2", "", "Oct6,POU2F2,POU2F1", "Klf12", "",                                                    #10
"SOX10,Sox21,Sox14,Sox12", "", "POU6F2", "POU3F2,Klf7", "Tcfap2e,SOX3,SOX4,SOX11"                   #15
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G549_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "SOX10", "SOX10", "TFAP2C,TFAP2A,Smad3", "",                                        #5
"FOSL2,FOSL1", "KLF10,Smad3,Smad4", "", "Pou4f3", "",                                #10
"", "", "Neurog1,Twist2", "Klf7,RUNX2,Smad3,Klf4,RUNX1", "",                             #15
"TFAP2A,Tcfap2b,TFAP2C", "Sox5", "TFAP2B,Tcfap2e,TFAP2A,TFAP2C,Tcfap2b", "", "",     #20
"", "", "", "", "NeuroD1",                                                               #25
"RUNX2", "", "Sox10,Sox14,Sox6,Sox3,SOX9", "", "",                                       #30
"POU6F2,Pou4f3,Pou6f1", "", "", "KLF16,KLF14,KLF9", "",                                  #35
"", "", "", "Tbx20", "",                                                                      #40
"NeuroD1", "Tcf3", "SOX4,Sox11"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "RUNX1,RUNX2", "", "AP-1,Fosl2", "SOX3,Sox6,Sox2,Sox12,Sox4,Sox10",                   #5
"", "RUNX1,RUNX2,Sox17", "Tbox:Smad", "Sox17", "",                                         #10
"Sox8,SOX10,Pou5f1::Sox2,Sox6"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("TCF3,TCF4", "TBX15", "", "", "",                             #5
"", "Tcf3", "SMAD3", "Sox4,SOX10", "",                             #10
"", "Sox17,Sox1", "Tcfap2e,Sox4,Sox11", "", "Tcfap2e,Tcf3",        #15
"", "POU6F2", "", "TCF4,TCF3,TBX1,TBX5,TBX15"                                 #19
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-3"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "TCF4,TCF3", "", "", "",                                                                             #5
"Klf7,Klf12", "Tcf4,Tcf3", "Sox6,Sox11,Sox4,Sox3,Sox10,Sox15", "", "Tcfap2e,SOX11,Sox4",           #10
"Sox1,Sox17", "Sox5", "", "", "Smad2,Smad4,Smad3",                                                             #15
"Tcf21,Tcf12", "Klf4,KLF5,KLF1", "", "Tcfap2e,Tcf3"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G620_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "", "", "POU6F2,Pou6f1", "KLF10,KLF9",                                                                               #5
"", "NeuroD1,Ascl2,Ascl1,Tcf3", "", "Sox6,Sox15,Sox14,Sox2,Sox17,Sox3,Sox10,Sox9", "",                                    #10
"Brn1", "", "", "", "",                                                                                                   #15
"Eomes,TCF3,TCF4", "Tbx5,TBX4", "", "", "",                                                                                        #20
"RUNX2,RUNX1,Klf4", "RUNX2,RUNX1", "POU5F1,Oct4,Sox17,POU2F2,Oct6", "Sox7,Sox15,Sox21,Sox8,Sox30,Sox9,Sox2", "POU6F1",    #25
"RUNX2,RUNX1", "", "Sox14", "Sox3,Sox12,Sox6,Tbox:Smad,Sox14,Sox4,SOX10"                                                            #30
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "Pou5f1::Sox2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX5", "TBX15", "Tbx20", "Tbox:Smad", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU5F1::SOX2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX5", "TBX15", "Tbx20", "TBOX:SMAD", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU5F1::SOX2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX4", "TBX5", "TBX15", "TBX20", "TBOX:SMAD", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(JunJunZai)
id = "G523_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "", "SOX3,Sox11,Sox4,RUNX1,Sox2,Sox6", "Smad3,Smad4", "",                                      #5
"Twist2", "", "Oct6,POU2F2,POU2F1", "Klf12", "",                                                    #10
"SOX10,Sox21,Sox14,Sox12", "", "POU6F2", "POU3F2,Klf7", "Tcfap2e,SOX3,SOX4,SOX11"                   #15
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G549_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "SOX10", "SOX10", "TFAP2C,TFAP2A,Smad3", "",                                        #5
"FOSL2,FOSL1", "KLF10,Smad3,Smad4", "", "Pou4f3", "",                                #10
"", "", "Neurog1,Twist2", "Klf7,RUNX2,Smad3,Klf4,RUNX1", "",                             #15
"TFAP2A,Tcfap2b,TFAP2C", "Sox5", "TFAP2B,Tcfap2e,TFAP2A,TFAP2C,Tcfap2b", "", "",     #20
"", "", "", "", "NeuroD1",                                                               #25
"RUNX2", "", "Sox10,Sox14,Sox6,Sox3,SOX9", "", "",                                       #30
"POU6F2,Pou4f3,Pou6f1", "", "", "KLF16,KLF14,KLF9", "",                                  #35
"", "", "", "Tbx20", "",                                                                      #40
"NeuroD1", "Tcf3", "SOX4,Sox11"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "RUNX1,RUNX2", "", "AP-1,Fosl2", "SOX3,Sox6,Sox2,Sox12,Sox4,Sox10",                   #5
"", "RUNX1,RUNX2,Sox17", "Tbox:Smad", "Sox17", "",                                         #10
"Sox8,SOX10,Pou5f1::Sox2,Sox6"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("TCF3,TCF4", "TBX15", "", "", "",                             #5
"", "Tcf3", "SMAD3", "Sox4,SOX10", "",                             #10
"", "Sox17,Sox1", "Tcfap2e,Sox4,Sox11", "", "Tcfap2e,Tcf3",        #15
"", "POU6F2", "", "TCF4,TCF3,TBX1,TBX5,TBX15"                                 #19
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G583_L-3"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "TCF4,TCF3", "", "", "",                                                                             #5
"Klf7,Klf12", "Tcf4,Tcf3", "Sox6,Sox11,Sox4,Sox3,Sox10,Sox15", "", "Tcfap2e,SOX11,Sox4",           #10
"Sox1,Sox17", "Sox5", "", "", "Smad2,Smad4,Smad3",                                                             #15
"Tcf21,Tcf12", "Klf4,KLF5,KLF1", "", "Tcfap2e,Tcf3"))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G620_L-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/ATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alter_motifs <- toupper(c("", "", "", "POU6F2,Pou6f1", "KLF10,KLF9",                                                                               #5
"", "NeuroD1,Ascl2,Ascl1,Tcf3", "", "Sox6,Sox15,Sox14,Sox2,Sox17,Sox3,Sox10,Sox9", "",                                    #10
"Brn1", "", "", "", "",                                                                                                   #15
"Eomes,TCF3,TCF4", "Tbx5,TBX4", "", "", "",                                                                                        #20
"RUNX2,RUNX1,Klf4", "RUNX2,RUNX1", "POU5F1,Oct4,Sox17,POU2F2,Oct6", "Sox7,Sox15,Sox21,Sox8,Sox30,Sox9,Sox2", "POU6F1",    #25
"RUNX2,RUNX1", "", "Sox14", "Sox3,Sox12,Sox6,Tbox:Smad,Sox14,Sox4,SOX10"                                                            #30
))
motif_df <- motif_table %>% mutate(motif = alter_motifs)
motif_df <- motif_df %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_df$motif))
save(motif_df, file = paste0("./outputs/", id, ".motif.RData"))
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU5F1::SOX2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX4", "TBX5", "TBX15", "TBX20", "TBOX:SMAD", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(tidyr)
library(tibble)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX14", "SOX15", "SOX17", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU5F1::SOX2", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("TBX1", "TBX4", "TBX5", "TBX15", "TBX20", "TBOX:SMAD", "EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2B", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_df %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
pdf(paste0("./plts/GSC_motif_family.pdf"), width = 6, height = 1.5)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
