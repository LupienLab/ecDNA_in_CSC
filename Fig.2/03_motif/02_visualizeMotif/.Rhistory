SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX13", "SOX14", "SOX15", "SOX17", "SOX18", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1", "POU2F3"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
ZEB   = c("ZEB1"),
SNAI  = c("SNAI1", "SNAI2"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2A", "TCFAP2B", "TCFAP2C", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_table %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
dir.create("plts")
pdf(paste0("./plts/motif_family.pdf"), width = 6, height = 1.75)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(JunJunZai)
id = "A7TK_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults/"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "Tcf3,Tcf4", "Klf4", "",                                    #5
"", "Sox8", "", "Sox4,Sox11", "",                                   #10
"", "", "Tcf4", "", "FOSL1",                                        #15
"Eomes,Klf7", "Smad2,Smad4", "", "NeuroD1,Tcf12", "",               #20
"", "Sox5", "Pou6f1", "", "Klf7",                                   #25
"Smad3", "Sox13,Klf4,Eomes", "RUNX", "Smad4,Smad2", "",             #30
"", "Klf7,Klf4", "", "", "Smad2",                                   #35
"Sox3,Sox17,Sox14,Sox9,Sox2"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_table$motif))
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "A7TK_T-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "", "", "Smad3",                                                            #5
"Klf4", "", "Smad3", "", "RUNX2",                                                        #10
"Tcfap2a", "", "", "Smad2,Smad4,Smad3", "Tcfap2e,Tcfap2c,Tcfap2a,TFAP2A",           #15
"", "Sox11,Sox13,Sox4,Sox5,Sox8", "", "SOX10,Sox3", "AP-1,Tcf4",
"Sox12,Sox4,Sox11,Sox5"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "Tcfap2a,Tcfap2c,Tcfap2b,TFAP2A", "TFAP2A,Ascl2,Klf4", "Sox6,Sox2", "Klf7",    #5
"Klf7,Ascl2,Klf4", "Sox6,Sox12,Sox11,Sox7,Sox18"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("Sox8", "", "TFAP2A", "Sox14,Sox9", "Oct2,Oct4,Pou3f3,Pou5f1,Pou2f3,Pou2f2",             #5
"", "", "Smad4", "Sox17,Sox10,Sox6,AP-1,Sox3,Sox30", "RUNX2,RUNX1",
"Smad3", "", "Eomes,RUNX2"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-3"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "Smad3,TFAP2A,Smad2", "", "Tcfap2b,Tcfap2e",                                             #5
"", "AP-1", "", "RUNX2,Smad4,Smad2", "TFAP2A,Smad3",     #10
"", "", "Tcfap2e", "", "",                                     #15
"", "Smad2,Smad4", "", "Smad4,Smad2,Klf7,Smad3", "",                                                                                  #20
"", "", "", "", "Smad3",                                                                          #25
"", "", "Pou2f3,Oct4,Oct2", "", "RUNX1,RUNX2",                      #30
"", "Tcf3,Tcf4", "Sox14", "", ""))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G946_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("Pou5f1,Pou3f3,Oct4", "RUNX2,RUNX1", "", "Eomes", "NeuroD1",      #5
"Klf4,Eomes,Klf7", "", "Eomes", "", "Sox14,Sox7",                                              #10
"", "", "Smad3,Ascl2", "", "Tcfap2e,Sox11,Sox4,Tcf3",                     #15
"RUNX2,RUNX1", "AP-1"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G958_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "Sox30", "", "AP-1", "",
"Tcf3,Tcf4", "", "", "", "",
"Smad3", "RUNX1", "Tcf3,Tcf4", "", "",                                    #15
"Sox15", "Klf7", "", "Sox5,Sox8,Sox7,Sox18,Sox12,,Sox17", "Smad4,Smad2,Smad3,Tcf3",                               #20
"", "Tcfap2e,Tcf3", "Sox17,Klf4", "Smad4,Ascl2,TFAP2A", "Pou2f2",
"Smad3,NeuroD1,Eomes", "Smad3,SOX10", "Tcfap2e,Sox4,Sox11,Sox12,Sox10"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(JunJunZai)
id = "A7TK_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults/"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "Tcf3,Tcf4", "Klf4", "",                                    #5
"", "Sox8", "", "Sox4,Sox11", "",                                   #10
"", "", "Tcf4", "", "FOSL1",                                        #15
"Eomes,Klf7", "Smad2,Smad4", "", "NeuroD1,Tcf12", "",               #20
"", "Sox5", "Pou6f1", "", "Klf7",                                   #25
"Smad3", "Sox13,Klf4,Eomes", "RUNX", "Smad4,Smad2", "",             #30
"", "Klf7,Klf4", "", "", "Smad2",                                   #35
"Sox3,Sox17,Sox14,Sox9,Sox2"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_table$motif))
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "A7TK_T-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "", "", "Smad3",                                                            #5
"Klf4", "", "Smad3", "", "RUNX2",                                                        #10
"Tcfap2a", "", "", "Smad2,Smad4,Smad3", "Tcfap2e,Tcfap2c,Tcfap2a,TFAP2A",           #15
"", "Sox11,Sox13,Sox4,Sox5,Sox8", "", "SOX10,Sox3", "AP-1,Tcf4",
"Sox12,Sox4,Sox11,Sox5"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "Tcfap2a,Tcfap2c,Tcfap2b,TFAP2A", "TFAP2A,Ascl2,Klf4", "Sox6,Sox2", "Klf7",    #5
"Klf7,Ascl2,Klf4", "Sox6,Sox12,Sox11,Sox7,Sox18"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("Sox8", "", "TFAP2A", "Sox14,Sox9", "Oct2,Oct4,Pou3f3,Pou5f1,Pou2f3,Pou2f2",             #5
"", "", "Smad4", "Sox17,Sox10,Sox6,AP-1,Sox3,Sox30", "RUNX2,RUNX1",
"Smad3", "", "Eomes,RUNX2"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-3"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "Smad3,TFAP2A,Smad2", "", "Tcfap2b,Tcfap2e",                                             #5
"", "AP-1", "", "RUNX2,Smad4,Smad2", "TFAP2A,Smad3",     #10
"", "", "Tcfap2e", "", "",                                     #15
"", "Smad2,Smad4", "", "Smad4,Smad2,Klf7,Smad3", "",                                                                                  #20
"", "", "", "", "Smad3",                                                                          #25
"", "", "Pou2f3,Oct4,Oct2", "", "RUNX1,RUNX2",                      #30
"", "Tcf3,Tcf4", "Sox14", "", ""))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G946_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("Pou5f1,Pou3f3,Oct4", "RUNX2,RUNX1", "", "Eomes", "NeuroD1",      #5
"Klf4,Eomes,Klf7", "", "Eomes", "", "Sox14,Sox7",                                              #10
"", "", "Smad3,Ascl2", "", "Tcfap2e,Sox11,Sox4,Tcf3",                     #15
"RUNX2,RUNX1", "AP-1"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G958_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "Sox30", "", "AP-1", "",                                   #5
"Tcf3,Tcf4", "", "", "", "",
"Smad3", "RUNX1", "Tcf3,Tcf4", "", "",                                    #15
"Sox15", "Klf7", "", "Sox5,Sox8,Sox7,Sox18,Sox12,,Sox17", "Smad4,Smad2,Smad3,Tcf3",                               #20
"", "Tcfap2e,Tcf3", "Sox17,Klf4", "Smad4,Ascl2,TFAP2A", "Pou2f2",
"Smad3,NeuroD1,Eomes", "Smad3,SOX10", "Tcfap2e,Sox4,Sox11,Sox12,Sox10"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX13", "SOX14", "SOX15", "SOX17", "SOX18", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1", "POU2F3"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
SNAI  = c("SNAI1", "SNAI2"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2A", "TCFAP2B", "TCFAP2C", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_table %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX13", "SOX14", "SOX15", "SOX17", "SOX18", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1", "POU2F3"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2A", "TCFAP2B", "TCFAP2C", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_table %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
?column_to_rownames
rm(list = ls())
library(tibble)
library(dplyr)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX13", "SOX14", "SOX15", "SOX17", "SOX18", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1", "POU2F3"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2A", "TCFAP2B", "TCFAP2C", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_table %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
?pivot_wider
rm(list = ls())
library(tibble)
library(tidyr)
library(dplyr)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX13", "SOX14", "SOX15", "SOX17", "SOX18", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1", "POU2F3"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2A", "TCFAP2B", "TCFAP2C", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_table %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
dir.create("plts")
pdf(paste0("./plts/motif_family.pdf"), width = 6, height = 1.75)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
rm(list = ls())
library(dplyr)
library(stringr)
library(data.table)
library(JunJunZai)
id = "A7TK_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults/"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "Tcf3,Tcf4", "Klf4", "",                                    #5
"", "Sox8", "", "Sox4,Sox11", "",                                   #10
"", "", "Tcf4", "", "FOSL1",                                        #15
"Eomes,Klf7", "Smad2,Smad4", "", "NeuroD1,Tcf12", "",               #20
"", "Sox5", "Pou6f1", "", "Klf7",                                   #25
"Smad3", "Sox13,Klf4,Eomes", "RUNX", "Smad4,Smad2", "",             #30
"", "Klf7,Klf4", "", "", "Smad2",                                   #35
"Sox3,Sox17,Sox14,Sox9,Sox2"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
sort(unique(motif_table$motif))
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "A7TK_T-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "", "", "Smad3",                                                            #5
"Klf4", "", "Smad3", "", "RUNX2",                                                        #10
"Tcfap2a", "", "", "Smad2,Smad4,Smad3", "Tcfap2e,Tcfap2c,Tcfap2a,TFAP2A",           #15
"", "Sox11,Sox13,Sox4,Sox5,Sox8", "", "SOX10,Sox3", "AP-1,Tcf4",
"Sox12,Sox4,Sox11,Sox5"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "Tcfap2a,Tcfap2c,Tcfap2b,TFAP2A", "TFAP2A,Ascl2,Klf4", "Sox6,Sox2", "Klf7",    #5
"Klf7,Ascl2,Klf4", "Sox6,Sox12,Sox11,Sox7,Sox18"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-2"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("Sox8", "", "TFAP2A", "Sox14,Sox9", "Oct2,Oct4,Pou3f3,Pou5f1,Pou2f3,Pou2f2",             #5
"", "", "Smad4", "Sox17,Sox10,Sox6,AP-1,Sox3,Sox30", "RUNX2,RUNX1",
"Smad3", "", "Eomes,RUNX2"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G933_T-3"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "", "Smad3,TFAP2A,Smad2", "", "Tcfap2b,Tcfap2e",                                             #5
"", "AP-1", "", "RUNX2,Smad4,Smad2", "TFAP2A,Smad3",     #10
"", "", "Tcfap2e", "", "",                                     #15
"", "Smad2,Smad4", "", "Smad4,Smad2,Klf7,Smad3", "",                                                                                  #20
"", "", "", "", "Smad3",                                                                          #25
"", "", "Pou2f3,Oct4,Oct2", "", "RUNX1,RUNX2",                      #30
"", "Tcf3,Tcf4", "Sox14", "", ""))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G946_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("Pou5f1,Pou3f3,Oct4", "RUNX2,RUNX1", "", "Eomes", "NeuroD1",      #5
"Klf4,Eomes,Klf7", "", "Eomes", "", "Sox14,Sox7",                                              #10
"", "", "Smad3,Ascl2", "", "Tcfap2e,Sox11,Sox4,Tcf3",                     #15
"RUNX2,RUNX1", "AP-1"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
#~~~
id = "G958_T-1"
motif_files <- list.files(path = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/homerResults"), pattern = "^motif[0-9]+\\.motif$", full.names = TRUE)
motif_table <- loadHomerRes(homerDir = paste0("/Users/chupan/Documents/data_su2c/scATAC/motif/", id, "/results/"), novo = T, known = F, motifIndex = 1:length(motif_files))@'novo res'
alterMotifs <- toupper(c("", "Sox30", "", "AP-1", "",                                   #5
"Tcf3,Tcf4", "", "", "", "",
"Smad3", "RUNX1", "Tcf3,Tcf4", "", "",                                    #15
"Sox15", "Klf7", "", "Sox5,Sox8,Sox7,Sox18,Sox12,,Sox17", "Smad4,Smad2,Smad3,Tcf3",                               #20
"", "Tcfap2e,Tcf3", "Sox17,Klf4", "Smad4,Ascl2,TFAP2A", "Pou2f2",
"Smad3,NeuroD1,Eomes", "Smad3,SOX10", "Tcfap2e,Sox4,Sox11,Sox12,Sox10"))
motif_table <- motif_table %>% mutate(motif = alterMotifs)
motif_table <- motif_table %>% arrange(-neglogPvalue) %>% tidyr::separate_rows(motif, sep = ",") %>% mutate(rank = 1:dim(.)[1])
save(motif_table, file = paste0("./outputs/", id, ".motif.RData"))
rm(list = ls())
library(tibble)
library(tidyr)
library(dplyr)
library(stringr)
library(data.table)
library(purrr)
#~~~ define TF family
tf_family <- list(
bHLH  = c("TWIST1", "TWIST2", "OLIG2", "ASCL1", "ASCL2", "NEUROD1", "NEUROG1", "TCF4", "TCF7", "TCF12", "TCF3", "TCF4", "TCF21"),
SOX   = c("SOX1", "SOX2", "SOX3", "SOX4", "SOX5", "SOX6", "SOX7", "SOX8", "SOX9", "SOX10", "SOX11", "SOX12", "SOX13", "SOX14", "SOX15", "SOX17", "SOX18", "SOX21", "SOX30"),
POU   = c("POU3F2", "BRN2", "POU5F1", "OCT4", "POU3F1", "OCT6", "POU3F3", "BRN1", "POU2F2", "OCT2", "POU2F1", "OCT1", "POU6F2", "POU4F3", "POU6F1", "POU2F3"),
KLF   = c("KLF1", "KLF4", "KLF5", "KLF7", "KLF9", "KLF10", "KLF12", "KLF14", "KLF16"),
RUNX  = c("RUNX1", "RUNX2"),
SMAD  = c("SMAD2", "SMAD3", "SMAD4"),
Tbox  = c("EOMES"),
AP1   = c("AP-1", "FOSL1", "FOSL2"),
AP2   = c("TFAP2A", "TFAP2B", "TFAP2C", "TFAP2D", "TFAP2E", "TCFAP2A", "TCFAP2B", "TCFAP2C", "TCFAP2E")
)
#~~~ load and process files
files <- list.files(path = "./outputs/", pattern = "*.RData", full.names = TRUE)
loadFiles <- function(file) {
load(file)
sample_name <- gsub("\\.motif\\.RData$", "", basename(file))
motif_table %>% dplyr::select(motif, neglogPvalue) %>% mutate(sample = sample_name)
}
motif_data <- bind_rows(lapply(files, loadFiles)) %>% filter(motif != "") %>% as.data.frame()
#~~~ collapse motifs into TF families
motif_to_family <- map2_dfr(names(tf_family), tf_family, ~ data.frame(motif = .y, family = .x, stringsAsFactors = FALSE))
# Left join and replace motif names with family name where applicable
motif_data <- motif_data %>% left_join(motif_to_family, by = "motif") %>% mutate(motif = if_else(!is.na(family), family, motif)) %>% select(-family) %>% filter(motif != "")
unique(motif_data$motif)
filtered_df <- motif_data %>% group_by(motif, sample) %>% slice_max(order_by = neglogPvalue, n = 1, with_ties = FALSE) %>% ungroup() %>% as.data.table()
data <- data.table::dcast(filtered_df, sample ~ motif, value.var = "neglogPvalue") %>% magrittr::set_rownames(.$sample) %>% select(-sample)
heatmap_data <- motif_data %>% group_by(sample, motif) %>%
summarise(neglogPvalue = mean(neglogPvalue, na.rm = TRUE)) %>%  # handle duplicates
pivot_wider(names_from = motif, values_from = neglogPvalue, values_fill = 0) %>%  # fill NAs with 0
column_to_rownames("sample")  %>% select(sort(names(.))) # set rownames as sample names
#~~~ convert to matrix for heatmap
heatmap_matrix <- as.matrix(heatmap_data)
dir.create("plts")
pdf(paste0("./plts/GBM_motif_family.pdf"), width = 6, height = 1.75)
p <- pheatmap::pheatmap(heatmap_matrix, cluster_rows = F, cluster_cols = F, border_color = "black", lwd = 0.5,
color = colorRampPalette(c("white", "#0066FF33", "#3300FF33"))(200))
print(p)
dev.off()
log2(1)
log2(5)
2^4
